<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, user-scalable=no">
    <title>ë¡œë˜ 3D ì• ë‹ˆë©”ì´ì…˜ í…ŒìŠ¤íŠ¸</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'Helvetica Neue', sans-serif;
            background: #0d1421;
            color: #ffffff;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        
        h1 {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .animation-container {
            width: 100%;
            height: 400px;
            background: #131722;
            border-radius: 12px;
            overflow: hidden;
            position: relative;
        }
        
        .controls {
            margin-top: 20px;
            display: flex;
            justify-content: center;
            gap: 10px;
        }
        
        button {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            background: #2962ff;
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        button:hover {
            background: #1c54e9;
        }
        
        button:disabled {
            background: #444;
            cursor: not-allowed;
        }
        
        .result {
            margin-top: 20px;
            padding: 15px;
            background: #1a1f2e;
            border-radius: 12px;
            font-family: 'SF Mono', monospace;
            font-size: 18px;
            text-align: center;
        }
        
        .ball-container {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 15px;
        }
        
        .number-ball {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
            font-family: 'SF Mono', monospace;
        }
        
        .loading-spinner {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top: 4px solid #2962ff;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        #uploadContainer {
            margin: 20px 0;
            padding: 20px;
            border: 2px dashed #444;
            border-radius: 12px;
            text-align: center;
        }
        
        #fileInput {
            display: none;
        }
        
        #uploadBtn {
            display: inline-block;
            padding: 10px 20px;
            background: #333;
            color: white;
            border-radius: 8px;
            cursor: pointer;
            margin-bottom: 10px;
        }
        
        #previewImage {
            max-width: 100%;
            max-height: 200px;
            margin-top: 10px;
            border-radius: 8px;
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ë¡œë˜ 3D ì• ë‹ˆë©”ì´ì…˜ í…ŒìŠ¤íŠ¸</h1>
        
        <div id="uploadContainer">
            <label id="uploadBtn" for="fileInput">ë¡œë˜ë³¼ ì´ë¯¸ì§€ ì—…ë¡œë“œ</label>
            <input type="file" id="fileInput" accept="image/*">
            <div id="imageInfo"></div>
            <img id="previewImage" src="" alt="ì—…ë¡œë“œ ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸°">
        </div>
        
        <div class="animation-container" id="animationContainer"></div>
        
        <div class="controls">
            <button id="startBtn" disabled>ì• ë‹ˆë©”ì´ì…˜ ì‹œì‘</button>
            <button id="resetBtn" disabled>ì´ˆê¸°í™”</button>
            <button id="testBtn">í…ŒìŠ¤íŠ¸ ì´ë¯¸ì§€ ë¡œë“œ</button>
            <button id="lottoSimBtn" disabled>ğŸ² ì‹¤ì œ ë¡œë˜ ì‹œë®¬ë ˆì´ì…˜</button>
        </div>
        
        <div class="controls">
            <button id="soundToggleBtn" style="background: #28a745;">ğŸ”Š ì‚¬ìš´ë“œ ON</button>
            <button id="slowModeBtn">ğŸŒ ìŠ¬ë¡œìš° ëª¨ì…˜</button>
            <button id="cameraBtn">ğŸ“· ì¹´ë©”ë¼ ëª¨ë“œ</button>
            <button id="effectsBtn" style="background: #ff6b35;">âœ¨ íŠ¹ìˆ˜ íš¨ê³¼</button>
        </div>
        
        <div class="controls" style="flex-direction: column; gap: 10px;">
            <div style="display: flex; align-items: center; gap: 10px;">
                <label style="color: #333; font-weight: 500;">ğŸ”Š ë§ˆìŠ¤í„° ë³¼ë¥¨:</label>
                <input type="range" id="volumeSlider" min="0" max="100" value="50" 
                       style="flex: 1; height: 6px; background: linear-gradient(to right, #2962ff, #42a5f5); 
                              border-radius: 3px; outline: none; cursor: pointer;">
                <span id="volumeValue" style="min-width: 30px; text-align: center; font-weight: bold;">50</span>
            </div>
            
            <div style="display: flex; gap: 10px; justify-content: center;">
                <button id="ambientToggleBtn" style="background: #6c757d; font-size: 12px; padding: 5px 10px;">ğŸŒ€ í™˜ê²½ìŒ</button>
                <button id="reverbToggleBtn" style="background: #17a2b8; font-size: 12px; padding: 5px 10px;">ğŸ›ï¸ ë¦¬ë²„ë¸Œ</button>
                <button id="testSoundBtn" style="background: #ffc107; font-size: 12px; padding: 5px 10px;">ğŸµ í…ŒìŠ¤íŠ¸</button>
            </div>
        </div>
        
        <div class="result" id="result">
            <div>ì„ íƒëœ ë²ˆí˜¸:</div>
            <div class="ball-container" id="ballContainer"></div>
            <div id="animationStatus" style="margin-top: 15px; font-size: 14px; color: #888; text-align: center;">
                ì• ë‹ˆë©”ì´ì…˜ ìƒíƒœ: ëŒ€ê¸° ì¤‘
            </div>
        </div>
    </div>
    
    <!-- Three.js ë¼ì´ë¸ŒëŸ¬ë¦¬ (ë¡œì»¬ ë²„ì „) -->
    <script src="/static/js/three.min.js"></script>
    <!-- ë¡œë“œ ì‹¤íŒ¨ì‹œ CDN ë²„ì „ ëŒ€ì²´ ë¡œë“œ -->
    <script>
        // Three.js ë¡œë”© ìƒíƒœ í™•ì¸ ë° ëŒ€ì²´ ë¡œë”© ë©”ì»¤ë‹ˆì¦˜
        (function() {
            // THREE ê°ì²´ê°€ ìˆëŠ”ì§€ í™•ì¸
            if (typeof THREE === 'undefined') {
                console.warn('ë¡œì»¬ Three.js ë¡œë“œ ì‹¤íŒ¨, CDN ë²„ì „ìœ¼ë¡œ ì‹œë„í•©ë‹ˆë‹¤.');
                
                // ë¨¼ì € ìƒíƒœ ë©”ì‹œì§€ í‘œì‹œ
                const statusDiv = document.createElement('div');
                statusDiv.id = 'three-status';
                statusDiv.style.position = 'fixed';
                statusDiv.style.bottom = '10px';
                statusDiv.style.right = '10px';
                statusDiv.style.background = 'rgba(0,0,0,0.7)';
                statusDiv.style.color = '#ff9900';
                statusDiv.style.padding = '8px 12px';
                statusDiv.style.borderRadius = '4px';
                statusDiv.style.fontSize = '14px';
                statusDiv.style.zIndex = '1000';
                statusDiv.textContent = 'Three.js ë¡œë”© ì¤‘...';
                document.body.appendChild(statusDiv);
                
                // CDN ëª©ë¡ (ìˆœì°¨ì ìœ¼ë¡œ ì‹œë„)
                const cdnUrls = [
                    'https://cdnjs.cloudflare.com/ajax/libs/three.js/r146/three.min.js',
                    'https://cdn.jsdelivr.net/npm/three@0.146.0/build/three.min.js',
                    'https://unpkg.com/three@0.146.0/build/three.min.js'
                ];
                
                // CDNìœ¼ë¡œë¶€í„° ìˆœì°¨ì ìœ¼ë¡œ ë¡œë“œ ì‹œë„
                let currentCdnIndex = 0;
                
                function loadFromNextCdn() {
                    if (currentCdnIndex >= cdnUrls.length) {
                        // ëª¨ë“  CDN ì‹œë„ ì‹¤íŒ¨
                        statusDiv.textContent = 'Three.js ë¡œë“œ ì‹¤íŒ¨!';
                        statusDiv.style.color = 'red';
                        
                        // ì˜¤ë¥˜ ë©”ì‹œì§€ í‘œì‹œ
                        const errorDiv = document.createElement('div');
                        errorDiv.style.position = 'fixed';
                        errorDiv.style.top = '50%';
                        errorDiv.style.left = '50%';
                        errorDiv.style.transform = 'translate(-50%, -50%)';
                        errorDiv.style.background = 'rgba(0,0,0,0.8)';
                        errorDiv.style.color = 'white';
                        errorDiv.style.padding = '20px';
                        errorDiv.style.borderRadius = '8px';
                        errorDiv.style.maxWidth = '80%';
                        errorDiv.style.textAlign = 'center';
                        errorDiv.style.zIndex = '1001';
                        errorDiv.innerHTML = `
                            <h3 style="color: #ff5555; margin-top: 0;">Three.js ë¡œë“œ ì‹¤íŒ¨</h3>
                            <p>3D ì• ë‹ˆë©”ì´ì…˜ì„ ìœ„í•œ í•„ìˆ˜ ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¡œë“œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.</p>
                            <p>ê°€ëŠ¥í•œ í•´ê²° ë°©ë²•:</p>
                            <ul style="text-align: left;">
                                <li>ì¸í„°ë„· ì—°ê²°ì„ í™•ì¸í•´ì£¼ì„¸ìš”</li>
                                <li>ë¸Œë¼ìš°ì €ë¥¼ ìµœì‹  ë²„ì „ìœ¼ë¡œ ì—…ë°ì´íŠ¸í•˜ì„¸ìš”</li>
                                <li>ë‹¤ë¥¸ ë¸Œë¼ìš°ì €(Chrome, Firefox, Safari)ì—ì„œ ì‹œë„í•´ë³´ì„¸ìš”</li>
                                <li>ë¸Œë¼ìš°ì € ìºì‹œë¥¼ ë¹„ìš°ê³  ìƒˆë¡œê³ ì¹¨í•´ë³´ì„¸ìš”</li>
                            </ul>
                            <button onclick="window.location.reload()" style="padding: 8px 16px; background: #2962ff; border: none; color: white; border-radius: 4px; margin-top: 10px; cursor: pointer;">í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨</button>
                        `;
                        document.body.appendChild(errorDiv);
                        return;
                    }
                    
                    // ìƒíƒœ ì—…ë°ì´íŠ¸
                    statusDiv.textContent = `Three.js ë¡œë”© ì¤‘... (${currentCdnIndex + 1}/${cdnUrls.length})`;
                    
                    // ë‹¤ìŒ CDNì—ì„œ ë¡œë“œ ì‹œë„
                    const script = document.createElement('script');
                    script.src = cdnUrls[currentCdnIndex];
                    
                    script.onload = function() {
                        // ë¡œë“œ ì„±ê³µ
                        console.log('Three.js ë¡œë“œ ì„±ê³µ (CDN):', THREE.REVISION);
                        statusDiv.textContent = `Three.js ë¡œë“œ ì„±ê³µ (ë²„ì „: ${THREE.REVISION})`;
                        statusDiv.style.color = '#00ff00';
                        
                        // 3ì´ˆ í›„ ìƒíƒœ ë©”ì‹œì§€ ìˆ¨ê¸°ê¸°
                        setTimeout(function() {
                            statusDiv.style.opacity = '0';
                            statusDiv.style.transition = 'opacity 0.5s';
                            
                            // ì• ë‹ˆë©”ì´ì…˜ ë§¤ë‹ˆì € ì¬ì´ˆê¸°í™” ì‹œë„
                            if (window.ballAnimationManager) {
                                window.ballAnimationManager.reInitialize();
                            }
                        }, 3000);
                    };
                    
                    script.onerror = function() {
                        // ì´ CDN ì‹¤íŒ¨, ë‹¤ìŒ ì‹œë„
                        currentCdnIndex++;
                        loadFromNextCdn();
                    };
                    
                    document.head.appendChild(script);
                }
                
                // ì²« ë²ˆì§¸ CDN ë¡œë“œ ì‹œì‘
                loadFromNextCdn();
            } else {
                console.log('Three.js ë¡œë“œ ì„±ê³µ (ë¡œì»¬):', THREE.REVISION);
            }
        })();
    </script>
    
    <!-- ì• ë‹ˆë©”ì´ì…˜ ìŠ¤í¬ë¦½íŠ¸ -->
    <script src="/static/js/ball-animation.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // ìš”ì†Œë“¤ ê°€ì ¸ì˜¤ê¸°
            const fileInput = document.getElementById('fileInput');
            const previewImage = document.getElementById('previewImage');
            const imageInfo = document.getElementById('imageInfo');
            const startBtn = document.getElementById('startBtn');
            const resetBtn = document.getElementById('resetBtn');
            const testBtn = document.getElementById('testBtn');
            const lottoSimBtn = document.getElementById('lottoSimBtn');
            const ballContainer = document.getElementById('ballContainer');
            
            // ì• ë‹ˆë©”ì´ì…˜ ë§¤ë‹ˆì € ì¸ìŠ¤í„´ìŠ¤ ìƒì„± ë° ì´ˆê¸°í™”
            const ballAnimationManager = new BallAnimationManager();
            
            // ë¹„ë™ê¸° ì´ˆê¸°í™”
            ballAnimationManager.init('animationContainer').then((success) => {
                if (success) {
                    console.log('ì• ë‹ˆë©”ì´ì…˜ ë§¤ë‹ˆì € ì´ˆê¸°í™” ì„±ê³µ');
                    // í…ŒìŠ¤íŠ¸ ë²„íŠ¼ë“¤ í™œì„±í™”
                    testBtn.disabled = false;
                    lottoSimBtn.disabled = false;
                } else {
                    console.error('ì• ë‹ˆë©”ì´ì…˜ ë§¤ë‹ˆì € ì´ˆê¸°í™” ì‹¤íŒ¨');
                    // ì˜¤ë¥˜ ìƒíƒœ í‘œì‹œ
                    const errorMsg = document.createElement('div');
                    errorMsg.style.color = 'red';
                    errorMsg.style.textAlign = 'center';
                    errorMsg.style.padding = '10px';
                    errorMsg.textContent = '3D ì• ë‹ˆë©”ì´ì…˜ ì´ˆê¸°í™”ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë¸Œë¼ìš°ì €ê°€ WebGLì„ ì§€ì›í•˜ëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”.';
                    document.querySelector('.container').insertBefore(errorMsg, document.querySelector('.animation-container'));
                }
            });
            
            // í…ŒìŠ¤íŠ¸ ì´ë¯¸ì§€ ë¡œë“œ ë²„íŠ¼
            testBtn.addEventListener('click', () => {
                // í…ŒìŠ¤íŠ¸ ì´ë¯¸ì§€ URL (ê¸°ë³¸ ë¡œë˜ ì´ë¯¸ì§€)
                const testImageUrl = 'https://img.sportsworldi.com/content/image/2020/07/20/20200720511893.jpg';
                
                // ì´ë¯¸ì§€ ë¡œë“œ
                previewImage.src = testImageUrl;
                previewImage.style.display = 'block';
                imageInfo.textContent = 'í…ŒìŠ¤íŠ¸ ì´ë¯¸ì§€ ë¡œë“œë¨';
                startBtn.disabled = false;
            });
            
            // íŒŒì¼ ì—…ë¡œë“œ ì´ë²¤íŠ¸
            fileInput.addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (!file) return;
                
                // íŒŒì¼ ì •ë³´ í‘œì‹œ
                imageInfo.textContent = `${file.name} (${Math.round(file.size / 1024)}KB)`;
                
                // ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸°
                const reader = new FileReader();
                reader.onload = (e) => {
                    previewImage.src = e.target.result;
                    previewImage.style.display = 'block';
                    startBtn.disabled = false;
                };
                reader.readAsDataURL(file);
            });
            
            // ì• ë‹ˆë©”ì´ì…˜ ì‹œì‘ ë²„íŠ¼
            startBtn.addEventListener('click', () => {
                if (!previewImage.src) {
                    alert('ë¨¼ì € ì´ë¯¸ì§€ë¥¼ ì—…ë¡œë“œí•´ì£¼ì„¸ìš”.');
                    return;
                }
                
                // ì‹œì‘ ë²„íŠ¼ ë¹„í™œì„±í™”
                startBtn.disabled = true;
                
                // ì• ë‹ˆë©”ì´ì…˜ ì‹œì‘
                ballAnimationManager.processUserImage(previewImage.src, (success) => {
                    if (success) {
                        resetBtn.disabled = false;
                        
                        // íƒ€ì´ë¨¸ ì„¤ì • (ì• ë‹ˆë©”ì´ì…˜ ì™„ë£Œ ì˜ˆìƒ ì‹œê°„ í›„)
                        setTimeout(() => {
                            // ë²ˆí˜¸ í‘œì‹œ
                            displayNumbers(ballAnimationManager.selectedNumbers);
                            console.log("ì• ë‹ˆë©”ì´ì…˜ ì™„ë£Œ, ë²ˆí˜¸:", ballAnimationManager.selectedNumbers);
                            alert("ì• ë‹ˆë©”ì´ì…˜ ì™„ë£Œ, ë²ˆí˜¸: " + ballAnimationManager.selectedNumbers.join(", "));
                        }, 12000);
                    } else {
                        alert('ì• ë‹ˆë©”ì´ì…˜ ì²˜ë¦¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                        console.error('ì• ë‹ˆë©”ì´ì…˜ ì²˜ë¦¬ ì‹¤íŒ¨');
                        startBtn.disabled = false;
                    }
                });
            });
            
            // ì´ˆê¸°í™” ë²„íŠ¼
            resetBtn.addEventListener('click', () => {
                ballAnimationManager.reset();
                ballContainer.innerHTML = '';
                startBtn.disabled = false;
                resetBtn.disabled = true;
            });
            
            // ë²ˆí˜¸ í‘œì‹œ í•¨ìˆ˜
            function displayNumbers(numbers) {
                if (!numbers || numbers.length !== 6) return;
                
                ballContainer.innerHTML = '';
                
                numbers.forEach(num => {
                    const ball = document.createElement('div');
                    ball.className = 'number-ball';
                    ball.textContent = num;
                    
                    // ë²ˆí˜¸ ë²”ìœ„ì— ë”°ë¼ ìƒ‰ìƒ ì„¤ì •
                    let color;
                    if (num <= 10) color = '#FF3D7F'; // ë¹¨ê°•
                    else if (num <= 20) color = '#3DA5FF'; // íŒŒë‘
                    else if (num <= 30) color = '#3DFFCC'; // ë…¹ìƒ‰
                    else if (num <= 40) color = '#FFD93D'; // ë…¸ë‘
                    else color = '#FF8E3D'; // ì£¼í™©
                    
                    ball.style.backgroundColor = color;
                    ballContainer.appendChild(ball);
                });
            }
            
            // ì• ë‹ˆë©”ì´ì…˜ ìƒíƒœ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
            function updateAnimationStatus(message, color = '#888') {
                const statusElement = document.getElementById('animationStatus');
                if (statusElement) {
                    statusElement.textContent = `ì• ë‹ˆë©”ì´ì…˜ ìƒíƒœ: ${message}`;
                    statusElement.style.color = color;
                }
            }
            
            // ë¡œë˜ ì‹œë®¬ë ˆì´ì…˜ ì§„í–‰ ìƒí™© í‘œì‹œ
            ballAnimationManager.setProgressCallback = function(step, total, message) {
                updateAnimationStatus(`${message} (${step}/${total})`, '#2962ff');
            };
            
            // ì‚¬ìš´ë“œ í† ê¸€ ë²„íŠ¼
            const soundToggleBtn = document.getElementById('soundToggleBtn');
            let soundEnabled = true;
            
            soundToggleBtn.addEventListener('click', () => {
                soundEnabled = !soundEnabled;
                if (ballAnimationManager) {
                    ballAnimationManager.soundEnabled = soundEnabled;
                }
                
                soundToggleBtn.textContent = soundEnabled ? 'ğŸ”Š ì‚¬ìš´ë“œ ON' : 'ğŸ”‡ ì‚¬ìš´ë“œ OFF';
                soundToggleBtn.style.background = soundEnabled ? '#28a745' : '#6c757d';
            });
            
            // ìŠ¬ë¡œìš° ëª¨ì…˜ ë²„íŠ¼
            const slowModeBtn = document.getElementById('slowModeBtn');
            let slowMotion = false;
            
            slowModeBtn.addEventListener('click', () => {
                slowMotion = !slowMotion;
                if (ballAnimationManager) {
                    ballAnimationManager.friction = slowMotion ? 0.99 : 0.98;
                    ballAnimationManager.gravity = slowMotion ? -0.005 : -0.02;
                }
                
                slowModeBtn.textContent = slowMotion ? 'ğŸš€ ì¼ë°˜ ì†ë„' : 'ğŸŒ ìŠ¬ë¡œìš° ëª¨ì…˜';
                slowModeBtn.style.background = slowMotion ? '#fd7e14' : '#6f42c1';
            });
            
            // ì¹´ë©”ë¼ ëª¨ë“œ ë²„íŠ¼
            const cameraBtn = document.getElementById('cameraBtn');
            let cameraMode = 0; // 0: ê³ ì •, 1: íšŒì „, 2: ììœ ì‹œì 
            
            cameraBtn.addEventListener('click', () => {
                cameraMode = (cameraMode + 1) % 3;
                const modes = ['ğŸ“· ê³ ì • ì¹´ë©”ë¼', 'ğŸ”„ íšŒì „ ì¹´ë©”ë¼', 'ğŸ® ììœ  ì‹œì '];
                cameraBtn.textContent = modes[cameraMode];
                
                if (ballAnimationManager) {
                    ballAnimationManager.cameraMode = cameraMode;
                }
            });
            
            // íŠ¹ìˆ˜ íš¨ê³¼ ë²„íŠ¼
            const effectsBtn = document.getElementById('effectsBtn');
            let specialEffects = true;
            
            effectsBtn.addEventListener('click', () => {
                specialEffects = !specialEffects;
                if (ballAnimationManager) {
                    ballAnimationManager.specialEffectsEnabled = specialEffects;
                }
                
                effectsBtn.textContent = specialEffects ? 'âœ¨ íŠ¹ìˆ˜ íš¨ê³¼ ON' : 'âšª íŠ¹ìˆ˜ íš¨ê³¼ OFF';
                effectsBtn.style.background = specialEffects ? '#ff6b35' : '#6c757d';
            });
            
            // ë³¼ë¥¨ ìŠ¬ë¼ì´ë”
            const volumeSlider = document.getElementById('volumeSlider');
            const volumeValue = document.getElementById('volumeValue');
            
            volumeSlider.addEventListener('input', (e) => {
                const volume = parseInt(e.target.value);
                volumeValue.textContent = volume;
                
                if (ballAnimationManager && ballAnimationManager.setMasterVolume) {
                    ballAnimationManager.setMasterVolume(volume / 100);
                }
                
                // ìŠ¬ë¼ì´ë” ìƒ‰ìƒ ì—…ë°ì´íŠ¸
                const percentage = volume;
                volumeSlider.style.background = `linear-gradient(to right, #2962ff ${percentage}%, #ddd ${percentage}%)`;
            });
            
            // í™˜ê²½ìŒ í† ê¸€
            const ambientToggleBtn = document.getElementById('ambientToggleBtn');
            let ambientEnabled = false;
            
            ambientToggleBtn.addEventListener('click', () => {
                ambientEnabled = !ambientEnabled;
                
                if (ballAnimationManager && ballAnimationManager.ambientGainNode) {
                    const targetVolume = ambientEnabled ? 0.05 : 0;
                    ballAnimationManager.ambientGainNode.gain.setValueAtTime(
                        targetVolume, 
                        ballAnimationManager.audioContext.currentTime
                    );
                }
                
                ambientToggleBtn.textContent = ambientEnabled ? 'ğŸŒ€ í™˜ê²½ìŒ ON' : 'ğŸŒ€ í™˜ê²½ìŒ OFF';
                ambientToggleBtn.style.background = ambientEnabled ? '#28a745' : '#6c757d';
            });
            
            // ë¦¬ë²„ë¸Œ í† ê¸€
            const reverbToggleBtn = document.getElementById('reverbToggleBtn');
            let reverbEnabled = true;
            
            reverbToggleBtn.addEventListener('click', () => {
                reverbEnabled = !reverbEnabled;
                
                // ë¦¬ë²„ë¸Œ ìƒíƒœëŠ” ê° ì‚¬ìš´ë“œ ì¬ìƒ ì‹œ useReverb íŒŒë¼ë¯¸í„°ë¡œ ì œì–´ë©ë‹ˆë‹¤
                if (ballAnimationManager) {
                    ballAnimationManager.useReverbByDefault = reverbEnabled;
                }
                
                reverbToggleBtn.textContent = reverbEnabled ? 'ğŸ›ï¸ ë¦¬ë²„ë¸Œ ON' : 'ğŸ›ï¸ ë¦¬ë²„ë¸Œ OFF';
                reverbToggleBtn.style.background = reverbEnabled ? '#17a2b8' : '#6c757d';
            });
            
            // í…ŒìŠ¤íŠ¸ ì‚¬ìš´ë“œ ë²„íŠ¼
            const testSoundBtn = document.getElementById('testSoundBtn');
            
            testSoundBtn.addEventListener('click', () => {
                if (ballAnimationManager && soundEnabled) {
                    // ë‹¤ì–‘í•œ ì‚¬ìš´ë“œ í…ŒìŠ¤íŠ¸ ì‹œí€€ìŠ¤
                    ballAnimationManager.playBallBounceSound(1.0);
                    
                    setTimeout(() => {
                        ballAnimationManager.playBallSelectSound();
                    }, 500);
                    
                    setTimeout(() => {
                        ballAnimationManager.playWinSound();
                    }, 1500);
                    
                    // ë²„íŠ¼ ë¹„í™œì„±í™” (í…ŒìŠ¤íŠ¸ ì¤‘)
                    testSoundBtn.disabled = true;
                    testSoundBtn.textContent = 'ğŸµ ì¬ìƒ ì¤‘...';
                    
                    setTimeout(() => {
                        testSoundBtn.disabled = false;
                        testSoundBtn.textContent = 'ğŸµ í…ŒìŠ¤íŠ¸';
                    }, 4000);
                }
            });
            
            // ì´ˆê¸° í…ŒìŠ¤íŠ¸ ì• ë‹ˆë©”ì´ì…˜ (íë¸Œ íšŒì „)
            function startBasicTest() {
                if (!ballAnimationManager.scene || !ballAnimationManager.renderer) {
                    console.error('ì• ë‹ˆë©”ì´ì…˜ ë§¤ë‹ˆì €ê°€ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
                    return;
                }
                
                console.log('ê¸°ë³¸ í…ŒìŠ¤íŠ¸ ì¤€ë¹„ ì™„ë£Œ');
            }
            
            // ì´ˆê¸°í™” ì™„ë£Œ í›„ ëŒ€ê¸° ìƒíƒœë¡œ ìœ ì§€
            
            // ì‹¤ì œ ë¡œë˜ ì‹œë®¬ë ˆì´ì…˜ ë²„íŠ¼
            lottoSimBtn.addEventListener('click', () => {
                console.log('ì‹¤ì œ ë¡œë˜ ì‹œë®¬ë ˆì´ì…˜ ì‹œì‘');
                
                // ëª¨ë“  ë²„íŠ¼ ë¹„í™œì„±í™”
                startBtn.disabled = true;
                resetBtn.disabled = true;
                testBtn.disabled = true;
                lottoSimBtn.disabled = true;
                
                // ì´ì „ ê²°ê³¼ ì§€ìš°ê¸°
                ballContainer.innerHTML = '';
                
                // ì„ íƒ ì™„ë£Œ ì½œë°± ì„¤ì •
                ballAnimationManager.setSelectionCompleteCallback((selectedNumbers) => {
                    console.log('ì„ íƒ ì™„ë£Œëœ ë²ˆí˜¸ë“¤:', selectedNumbers);
                    displayNumbers(selectedNumbers);
                    
                    // ë²„íŠ¼ë“¤ ë‹¤ì‹œ í™œì„±í™”
                    resetBtn.disabled = false;
                    lottoSimBtn.disabled = false;
                    
                    // ê²°ê³¼ë¥¼ ì„œë²„ì— ì „ì†¡ (ì„ íƒì‚¬í•­)
                    sendResultToServer(selectedNumbers);
                });
                
                // ë¡œë˜ ì‹œë®¬ë ˆì´ì…˜ ì‹œì‘
                const success = ballAnimationManager.startLottoSimulation();
                
                if (!success) {
                    alert('ì‹œë®¬ë ˆì´ì…˜ì„ ì‹œì‘í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì• ë‹ˆë©”ì´ì…˜ì´ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
                    lottoSimBtn.disabled = false;
                }
            });
            
            // ì„œë²„ì— ê²°ê³¼ ì „ì†¡ í•¨ìˆ˜
            function sendResultToServer(numbers) {
                fetch('/api/generate', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        generated_numbers: numbers,
                        method: '3D_SIMULATION',
                        timestamp: new Date().toISOString()
                    })
                })
                .then(response => response.json())
                .then(data => {
                    console.log('ì„œë²„ ì‘ë‹µ:', data);
                })
                .catch(error => {
                    console.error('ì„œë²„ ì „ì†¡ ì˜¤ë¥˜:', error);
                });
            }
        });
    </script>
</body>
</html>
